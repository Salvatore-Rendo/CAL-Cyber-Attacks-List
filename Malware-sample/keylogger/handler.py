import argparse
import textwrap
import os

def validate_directory(directory):
   """
   Validate the provided log directory path.
   Args:
      directory (str): The directory path to validate.
   Returns:
      str: The validated directory path.
   Raises:
      argparse.ArgumentTypeError: If the directory is not valid or not writable.
   """
   if directory:
      if not os.path.exists(directory) or not os.path.isdir(directory):
            raise argparse.ArgumentTypeError(f"'{directory}' is not a valid directory path.")
      if not os.access(directory, os.W_OK):
            raise argparse.ArgumentTypeError(f"'{directory}' is not writable.")
   
   return directory

def validate_filename(filename):
   """
   Validate and sanitize the provided log file name.
   Args:
      filename (str): The file name to validate.
   Returns:
      str: The validated and sanitized file name.
   Raises:
      argparse.ArgumentTypeError: If the filename is not valid.
   """
   if filename:
      filename = "".join(x for x in filename if x.isalnum() or x in ('.', '_', '-'))
      if not filename:
            raise argparse.ArgumentTypeError("Invalid log file name.")
   
   return filename

def args_handler():
   """
   Parse command-line arguments for the keylogger script.
   Returns:
      tuple: A tuple containing the validated log directory and filename.
   """
   parser = argparse.ArgumentParser(
      formatter_class=argparse.RawDescriptionHelpFormatter,
      description=textwrap.dedent('''\
      This is a script that emulates a keylogger.
      After running this script, a file will be created containing all of your keystrokes.

      Usage examples:
      1. To run the keylogger with default settings:
         Run: python keylogger.py

      2. To specify the directory where the log file will be stored(default is current directory):
         Run: python keylogger.py -d /path/to/directory

      3. To specify the name of the log file(default is "keylog.txt"):
         Run: python keylogger.py -n my_log.txt

      4. To specify both the directory and the name of the log file:
         Run: python keylogger.py -d /path/to/directory -n my_log.txt
      ''')
   )  
   
   # Optional argument for the directory where the log file will be stored
   parser.add_argument('-d', '--directory', type=str, default="", help='Directory where the log file will be stored')
   
   # Optional argument for the name of the log file
   parser.add_argument('-n', '--name', type=str, default="keylog.txt", help='Name of the log file')
   
   args = parser.parse_args()
   
   directory = validate_directory(args.directory)
   filename = validate_filename(args.name)
   
   return directory, filename
